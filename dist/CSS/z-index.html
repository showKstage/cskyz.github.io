<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>翊政的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="记录前端学习日常">
    
    <link rel="preload" href="/assets/css/0.styles.03f3f677.css" as="style"><link rel="preload" href="/assets/js/app.4a08e194.js" as="script"><link rel="preload" href="/assets/js/2.f72d9393.js" as="script"><link rel="preload" href="/assets/js/13.86181960.js" as="script"><link rel="prefetch" href="/assets/js/10.a9c1ab0e.js"><link rel="prefetch" href="/assets/js/11.3f783500.js"><link rel="prefetch" href="/assets/js/12.9a5b973d.js"><link rel="prefetch" href="/assets/js/14.8d4e89f5.js"><link rel="prefetch" href="/assets/js/15.a74fe0d9.js"><link rel="prefetch" href="/assets/js/16.4881b7a3.js"><link rel="prefetch" href="/assets/js/17.f9febb4a.js"><link rel="prefetch" href="/assets/js/18.e2f1c31b.js"><link rel="prefetch" href="/assets/js/19.122efb44.js"><link rel="prefetch" href="/assets/js/20.a95bb4e2.js"><link rel="prefetch" href="/assets/js/21.db6c9c2d.js"><link rel="prefetch" href="/assets/js/22.7e99be20.js"><link rel="prefetch" href="/assets/js/23.e8a5ef6e.js"><link rel="prefetch" href="/assets/js/24.5487afee.js"><link rel="prefetch" href="/assets/js/25.cb493eb2.js"><link rel="prefetch" href="/assets/js/26.e342fd4c.js"><link rel="prefetch" href="/assets/js/27.1e9a8bc6.js"><link rel="prefetch" href="/assets/js/28.f38820c9.js"><link rel="prefetch" href="/assets/js/29.5c891081.js"><link rel="prefetch" href="/assets/js/3.c0942b04.js"><link rel="prefetch" href="/assets/js/30.28b9d3a3.js"><link rel="prefetch" href="/assets/js/31.e0384b47.js"><link rel="prefetch" href="/assets/js/32.9a77de45.js"><link rel="prefetch" href="/assets/js/33.f91f2e4c.js"><link rel="prefetch" href="/assets/js/34.43ae1d0d.js"><link rel="prefetch" href="/assets/js/35.7ef123db.js"><link rel="prefetch" href="/assets/js/36.cf07e4c0.js"><link rel="prefetch" href="/assets/js/37.11b54674.js"><link rel="prefetch" href="/assets/js/38.6daa424d.js"><link rel="prefetch" href="/assets/js/4.43879640.js"><link rel="prefetch" href="/assets/js/5.3fa497cf.js"><link rel="prefetch" href="/assets/js/6.45c573e9.js"><link rel="prefetch" href="/assets/js/7.35b68754.js"><link rel="prefetch" href="/assets/js/8.0e4ec641.js"><link rel="prefetch" href="/assets/js/9.47931518.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03f3f677.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">翊政的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML&amp;CSS" class="dropdown-title"><span class="title">HTML&amp;CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML&amp;CSS" class="mobile-dropdown-title"><span class="title">HTML&amp;CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link router-link-active">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/基础/" class="nav-link">
  初级
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/高级/" class="nav-link">
  高级
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/算法/剑指offer/" class="nav-link">
  剑指offer
</a></li><li class="dropdown-item"><!----> <a href="/算法/leetcode/" class="nav-link">
  leetcode
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/showKstage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML&amp;CSS" class="dropdown-title"><span class="title">HTML&amp;CSS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML&amp;CSS" class="mobile-dropdown-title"><span class="title">HTML&amp;CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link router-link-active">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/基础/" class="nav-link">
  初级
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/高级/" class="nav-link">
  高级
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/算法/剑指offer/" class="nav-link">
  剑指offer
</a></li><li class="dropdown-item"><!----> <a href="/算法/leetcode/" class="nav-link">
  leetcode
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/showKstage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>z-index属性值越大，盒子在层叠中的次序就越靠近用户的眼睛。</strong></p> <h3 id="开始文章前-上两道面试真题"><a href="#开始文章前-上两道面试真题" class="header-anchor">#</a> 开始文章前，上两道面试真题：</h3> <ol><li>z-index值大的元素一定在值小的上面吗？</li> <li>如何实现父元素覆盖子元素？</li></ol> <p><strong>先公布一下答案：</strong></p> <ol><li>z-index不一定会生效，生效了也不一定是值大的在上面，主要取决于<strong>层叠上下文</strong>；</li> <li>给父元素设置一个<strong>很大的z-index不能实现覆盖子元素</strong>，但是把<strong>子元素的z-index设置成负数</strong>却可以满足要求。</li></ol> <p>这两个题的考点都是层叠上下文，本文会讲清为什么。</p> <p>顾名不难思义，<strong>层叠上下文是把元素以三维的视角，放在不同层级来判断最后的堆叠关系</strong>，它由z-index这个属性来决定“等级“。</p> <h1 id="如何让z-index生效"><a href="#如何让z-index生效" class="header-anchor">#</a> 如何让z-index生效</h1> <p><strong>z-index是用于规定元素在z轴的高度，其值越大，离用户越近，越在“上面”。</strong></p> <p>使用时可能会感觉这个属性不太听话：给元素设置的z-index好像没有生效，它没有按照预期跑到其他元素上面。<strong>因为它单独使用时不生效，一定要配合定位属性一起</strong>，即只<strong>对指定了position属性的元素</strong>生效——只要<strong>不是默认值static</strong>，其他的absolute、relative、fixed都可以使z-index生效。</p> <p>如图1所示，在粉色的父元素下有有两个绝对定位的子元素1和2，两个子元素都没有设置z-index，通过top/left属性控制他们的位置，让他们发生重叠，可以看到2在1的上面。因为两者都没有设置z-index，其层叠等级都可以看作是0，<strong>同级的元素会根据其在HTML中的出现顺序出现顺序决定堆叠结果</strong>。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIZYHan3TqhnDahgxfucBYQibS3TcxYua2CnXV76PMqFtKRf7W9ytmEyw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">（图1）</p> <blockquote><p>公众号后台回复103获取在线代码地址</p></blockquote> <p>如果我们希望1在2的上面，如图2所示，可以给元素1加上z-index:1，而没有指定z-index的元素2的z-index依旧可以当作0对待，按照大小关系，元素1在元素2上面了。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeISmohYheb2YNibOKgKPepqGwcGd8xzxAWIB1A0oAhbtTmUn0BpH8Mtfw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">（图2）</p> <blockquote><p>公众号后台回复104获取在线代码地址</p></blockquote> <p>目前为止，都没什么难度，不过是大小比较而已。但很多时候会发现，层叠结果只用单纯的数值大小解释不了：</p> <ul><li>如图3所示，粉色背景下有两个子元素1和2，2中有一个子元素3。三个元素都是绝对定位，其中元素3的z-index值最大，但是却被压在元素1下面了。</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIrJOzlqCbGMiavUqJibiaEUHqCgrXibrSDZlJcExsbfTvGvAsdiaJ4MYK05A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">（图3）</p> <blockquote><p>公众号后台回复105获取在线代码地址</p></blockquote> <ul><li>稍微修改一下，只把2号元素的的z-index去掉。如图4所示，元素3又跑上来，盖在1号、2号元素上面了。</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIbAgEOgJmX3tYmibNTSy5levz9ejA5uOZ0xFFqbmgTkxkL0SnwHDnDHw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">（图4）</p> <blockquote><p>公众号后台回复106获取在线代码地址</p></blockquote> <p>要想搞懂这些问题，需要了解层叠上下文。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code>        <span class="token selector">.box</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">.one</span> <span class="token punctuation">{</span>
            <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
            <span class="token property">z-index</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>
            <span class="token property">left</span><span class="token punctuation">:</span> 66px<span class="token punctuation">;</span>
            <span class="token property">top</span><span class="token punctuation">:</span> 166px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">.two</span> <span class="token punctuation">{</span>
            <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
            <span class="token property">left</span><span class="token punctuation">:</span> 33px<span class="token punctuation">;</span>
            <span class="token property">top</span><span class="token punctuation">:</span> 33px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">.three</span> <span class="token punctuation">{</span>
            <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
            <span class="token property">z-index</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
            <span class="token property">left</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> aqua<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><code>ans：因为最一开始2号卡片的z-index是1，他会和他的子元素3号卡片结合成一起，形成一个层面，然后再和1号相比，此时1号在上面；</code></p> <p><code>如果后面3号浮上来是因为我们先处理z-index最小的1号卡片，(这里先不看没写z-index的2号卡片)在处理3号卡片</code></p> <h1 id="什么是层叠上下文"><a href="#什么是层叠上下文" class="header-anchor">#</a> 什么是层叠上下文</h1> <p>层叠上下文听起来比较抽象，你可以把它想象成一个三维空间，这个空间内有很多个平面。</p> <p>最大的层叠上下文就是由文档根元素——html形成的：它自身连同它的子元素就形成了一个最大的层叠上下文，也就是说，我们写的所有代码都是在根层叠上下文里的。</p> <p><strong>层叠上下文包含多个平面，具体来说：每个z-index的值形成一个平面，普通的无定位的块级元素也是一个平面，浮动元素也是一个平面，正是这些平面形成了层叠上下文。</strong></p> <p>除此之外，<strong>每个有z-index数值的元素也会连同它的子元素一起(写了z-index数值才处理子元素，这里第二种情况没写就不处理2号和3号)，生成一个小的层叠上下文，这个小层叠上下文和父级一样，拥有多个平面。</strong></p> <p>去处理这些上下文时，我们可以按照从小到大的顺序递归：<strong>先把最小的堆叠上下文中元素的顺序理好，拍成一片——当做一个整体，再与父级的堆叠上下文中其他元素比较。</strong></p> <p>不知道你有没有见过小吃街上的甲骨文仙贝：在一个大的压片的锅里放上面糊，在面糊上放上一个小虾，最后合上盖子夹紧，变成扁扁的一小片，可以清晰的看到上面虾的样子。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIyB2jSk3tficq6WuWK1BV1mibdCVDPGfHN6N2L8AHQxQFj3QF57zxmUwg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">（截图自网络）</p> <p>这个用来压片的锅就是层叠上下文，面糊、虾就是不同层级的html元素。他们在被压扁之前按照明确的上下顺序摆放，但最后都会形成薄薄的一片小饼干。这片小饼干可以被放进一个更大的锅里，和其他的食材，一起作为原料，继续做成一片大饼干，但在大锅眼里，这片小饼干诞生时是面糊在上还是虾子在上，根本不重要，因为现在它是一个整体，只有讨论这片小饼干在第二口锅中，与其他食材的摆放顺序才有意义。记住在这个模型，层级判断就很简单了。</p> <p>我们在面对一些难以判断的层级关系时，可以整理出一棵“层叠上下文树”，有点类似于dom树的结构。从小到大，把一个层叠上下文的内的不同平面的元素堆叠好，拍平，再放到父级的堆叠上下文树中。</p> <p>下面会用几个例子加深理解，都附有在线链接，可以先点进去看看，试试自己能否解释最后的呈现结果：</p> <h2 id="demo1"><a href="#demo1" class="header-anchor">#</a> demo1</h2> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeISmEfuZppMHcsiasNzibgceg4Q5V6kxT8tVJ6T15V1YcX4icUEiasFJjd9A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <blockquote><p>公众号后台回复107获取在线代码地址</p></blockquote> <p>其中DOM的层级关系如下</p> <ul><li><p>container1:absolute</p></li> <li><ul><li>1号:absolute z-index: 1</li> <li>2号:absolute z-index: 2</li></ul></li> <li><p>container2:absolute</p></li> <li><ul><li>3号:absolute z-index: 3</li></ul></li></ul> <p>container1和container2虽然都是绝对定位，但是没有设置z-index，不形成层叠上下文。所以只有根元素形成的这一个。</p> <blockquote><p>1、2、3号元素当然也形成了层叠上下文，但是没有子元素，所以不讨论，后面的例子也一样</p></blockquote> <p>形成的层叠上下文树如下：</p> <ul><li><p>根层叠上下文</p></li> <li><ul><li>1号:absolute z-index: 1</li> <li>2号:absolute z-index: 2</li> <li>3号:absolute z-index: 3</li></ul></li></ul> <p>最后的层叠关系不难判断，从下到上是<code>1号</code>-<code>2号</code>-<code>3号</code></p> <h2 id="demo2"><a href="#demo2" class="header-anchor">#</a> demo2</h2> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIwlBicpibLgwHQialnFK2pyZf0A7QItBrouAWxhANgl1TbiaTmlW3b2N06g/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <blockquote><p>公众号后台回复108获取在线代码地址</p></blockquote> <p>在demo1基础上稍加修改，给container1、container2加上z-index，现在DOM的层级关系变为：</p> <ul><li><p>container1:absolute z-index: 4</p></li> <li><ul><li>1号:absolute z-index: 1</li> <li>2号:absolute z-index: 2</li></ul></li> <li><p>container2:absolute z-index: 1</p></li> <li><ul><li>3号:absolute z-index: 3</li></ul></li></ul> <p>container1和container2都设置了z-index，加上根元素形成的层叠上下文，一共是三个。</p> <p>形成的层叠上下文树如下：</p> <ul><li><p>根层叠上下文</p></li> <li><ul><li>3号:absolute z-index: 3</li> <li>1号:absolute z-index: 1</li> <li>2号:absolute z-index: 2</li> <li>container1:absolute z-index: 4</li> <li>container2:absolute z-index: 1</li></ul></li></ul> <p>先看container1形成的层叠上下文，此时不管它本身的z-index是多少，形成层叠上下文的元素，都在当前这个上下文的底部，再是1号元素、2号。</p> <p>然后是container2形成的层叠上下文，只有一个3号元素，没什么好说。</p> <p>最后是根层叠上下文，它眼中container1和container2是一个整体，container2在下，container1在上。</p> <p>所以最后的顺序从下到上是：<code>container2(3号)</code>-<code>container1(1号-2号)</code></p> <h2 id="demo3"><a href="#demo3" class="header-anchor">#</a> demo3</h2> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeI20Via1WfSe6l9iajfnazR9CvdhkR71pKhs0vHU7jnic0uzXwCEpK1zdpA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <blockquote><p>公众号后台回复109获取在线代码地址</p></blockquote> <p>之前的container在视觉上看不到，现在给它一个颜色。container2的z-index设置为0，现在DOM的层级关系变为：</p> <ul><li><p>container1:absolute</p></li> <li><ul><li>1号:absolute z-index: 2</li></ul></li> <li><p>container2:absolute z-index: 0</p></li> <li><ul><li>2号:absolute z-index:-1</li></ul></li></ul> <p>现在可以看到，从下到上分别是<code>container1</code>-<code>container2</code>-<code>2号</code>-<code>1号</code>，</p> <p>这个例子比较难理解了，用层叠上下文树分析一下，一共有两个层叠上下文，一个是根元素形成的，另一个是container2</p> <ul><li><p>根层叠上下文</p></li> <li><ul><li>2号:absolute z-index:-1</li> <li>container1:absolute</li> <li>1号:absolute z-index: 2</li> <li>container2:absolute z-index: 0</li></ul></li></ul> <p>在container2形成的层叠上下文中，只有一个元素2，即使他的z-index是负数，也会放在container2之上，之前也说过，形成层叠上下文的元素在当前层叠上下文中总是最底下的。我们把他们两个拍平，合成一个整体。</p> <p>在根层叠上下文中，有container1、container2和1号三个元素。container1没有设置z-index，可以看作0，和container2层级相同，当层级相同时，按照在html中出现的先后顺序决定，所以是container1-container2；1号的层级最高，所以最后的层级是container1-container2-1号。</p> <p>最后把container2中的其他元素展开，得到最后的层叠关系<code>container1</code>-<code>container2(2号)</code>-<code>1号</code></p> <h1 id="层叠上下文规律"><a href="#层叠上下文规律" class="header-anchor">#</a> 层叠上下文规律</h1> <p>通过这三个例子应该能清楚感受到什么是层叠上下文了，总结一下他的规律：</p> <p>只有明确指定了z-index的值（不是auto）的定位元素才会生产一个层叠上下文，在这个层叠上下文中，内部元素层级都在它之上，哪怕是负数。</p> <p>如果是一个没有指定z-index（即为auto）的定位元素，那么虽然它不能形成一个层叠上下文，但是比较层级时，和z-index:0的等级是一样的。</p> <p>如果把浮动元素也放进来，我们可以得到一个完整的层叠等级：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/cpWiaicnZTaub9mhKL5cPOpUlq74eLXpeIvQutvAAOEfiaL96vDbH7GxNQgB7pEcFdlPBicOJPoKUjf1Niaun048VDQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <p>这个图看起来复杂，其实不用背，可以一个个来看：</p> <ol><li>首先看块级元素，我们写的大部分代码都是它，比如div，我们能看到它们，就是因为块级元素是在层叠上下文根元素之上的。</li> <li>接着是浮动元素和文字，而浮动本身是为了实现环绕效果的，所以是浮动元素和文字是同一级，这样才不会遮挡。</li> <li>然后是定位元素，我们知道，不指定z-index，即为auto时，是会在浮动元素之上的，在层级关系中其实相当于0；可以继续推出，z-index&gt;0的会在z-index=0之上。</li> <li>唯一要特意记忆的是z-index&lt;0，他的层级关系是在块元素之下，形成层叠上下文的根元素之上的。</li></ol> <p>其中，当多个层叠等级相同的元素重叠时，按照html中出现的顺序决定堆叠上下关系，后出现的在上面。</p> <h1 id="css3的新特性"><a href="#css3的新特性" class="header-anchor">#</a> CSS3的新特性</h1> <p>除了被定位的z-index元素，CSS3还提供另外的方法能生成一个层叠上下文。</p> <p>特别偏门的不列举了，意义不大，开发中可能会用到的有：</p> <ol><li>弹性布局的子项（父元素display:flex|inline-flex)，并且z-index不是auto时</li> <li>opacity非1的元素</li> <li>transform非none的元素</li> <li>filter非none的元素</li></ol> <p>这些都能生成层叠上下文，flex子元素还可以使用z-index，近一步精确设置层级，其余三个设置z-index不生效，但在比较层级关系是被当作z-index:0对待。</p> <h1 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h1> <p>层叠上下文和z-index两个概念是分不开的。一个层叠上下文是由许多拥有z-index属性元素形成的平面构成的；有z-index属性的元素又会形成一个子层叠上下文。当然，这里的z-index必须是被有效设置的，在以前是指被定位的元素——position为absolute/relative等，现在它还可以是flex的子元素。</p> <p>在比较复杂元素的层叠顺序时，主要是要整理出一棵层叠上下文树，一个元素的层叠等级只在当前这个层叠上下文中有意义。</p> <p>回到开头的两个问题，答案也不难理解了。</p> <ol><li>z-index大的元素不一定在小的元素之上。因为它不一定生效，通常需要是一个定位元素才生效，在CSS3之后，弹性元素的子元素也可以生效；在z-index生效之后，也不是单纯的大小比较，因为这个数值只在当前的层叠上下文中才有意义。</li> <li>要实现父元素覆盖子元素，去给父元素设置一个很大的z-index是没有用的。因为这样他就成为一个层叠上下文的根元素了，无论子元素被如何设置都会在这个层叠上下文根元素之上。正确的解法是把子元素的z-index设置为负数，这样父元素是一个块级元素，z-index&lt;0 的子元素会在块级元素之下，就可以实现我们想要的效果。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4a08e194.js" defer></script><script src="/assets/js/2.f72d9393.js" defer></script><script src="/assets/js/13.86181960.js" defer></script>
  </body>
</html>
